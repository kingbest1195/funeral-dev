# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è Yandex Cloud S3 + CDN

–≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Å–∞–π—Ç–∞, —Ä–∞–∑–º–µ—â—ë–Ω–Ω–æ–≥–æ –≤ Yandex Cloud Object Storage –∏ –¥–æ—Å—Ç–∞–≤–ª—è–µ–º–æ–≥–æ —á–µ—Ä–µ–∑ Yandex CDN.

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ S3 –±–∞–∫–µ—Ç–∞ (Lifecycle –ø—Ä–∞–≤–∏–ª–∞)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Object Storage

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [Yandex Cloud Console](https://console.cloud.yandex.ru/)
2. –í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Ä–≤–∏—Å **Object Storage** ‚Üí **Buckets**
3. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –±–∞–∫–µ—Ç `ritual-vek-frontend`
4. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **Settings** ‚Üí **Lifecycle**
5. –°–æ–∑–¥–∞–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞:

#### –ü—Ä–∞–≤–∏–ª–æ 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- **Status**: Enabled
- **Description**: "–£–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ 1 –¥–µ–Ω—å"
- **Prefix**: `temp/`
- **Type**: Expiration
- **Days**: 1

#### –ü—Ä–∞–≤–∏–ª–æ 2: –ü–µ—Ä–µ—Ö–æ–¥ –≤ —Ö–æ–ª–æ–¥–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –∞—Ä—Ö–∏–≤–æ–≤
- **Status**: Enabled
- **Description**: "–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤"
- **Prefix**: `archive/`
- **Type**: Transition
- **Storage Class**: Cold Storage
- **Days**: 30

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ —á–µ—Ä–µ–∑ CLI

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ CLI Yandex Cloud
curl https://storage.yandexcloud.net/yandexcloud-yc/install.sh | bash

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
yc storage bucket update \
  --name ritual-vek-frontend \
  --lifecycle-rules file://.s3-cache-headers.json
```

## üåê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Cloud CDN

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Cloud CDN** ‚Üí **CDN resources**
2. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à CDN —Ä–µ—Å—É—Ä—Å `—Ä–∏—Ç—É–∞–ª-–≤–µ–∫.—Ä—Ñ`
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **Caching** ‚Üí **Edit**

#### –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:

**CDN caching**:
- ‚úÖ **Enabled**
- **Settings**: Custom settings
- **Default cache lifetime**: 4 days
- **Cache lifetime for response codes**:
  - HTTP response: 4xx ‚Üí a few seconds
  - Add custom codes –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

**Browser caching**:
- ‚úÖ **Enabled**
- **Default cache lifetime**: 4 days

**Additional settings**:
- **Cookie**: ‚òê Ignore (–¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞)
- **Query parameters**: ‚òê Ignore (–¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞)

### –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —Ç–∏–ø–∞–º –∫–æ–Ω—Ç–µ–Ω—Ç–∞

#### –î–ª—è HTML —Ñ–∞–π–ª–æ–≤:
- **CDN cache**: 5 –º–∏–Ω—É—Ç (300 —Å–µ–∫—É–Ω–¥)
- **Browser cache**: 5 –º–∏–Ω—É—Ç (300 —Å–µ–∫—É–Ω–¥)

#### –î–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ (JS/CSS —Å —Ö—ç—à–µ–º):
- **CDN cache**: 1 –≥–æ–¥ (365 –¥–Ω–µ–π)
- **Browser cache**: 1 –≥–æ–¥ (365 –¥–Ω–µ–π)

#### –î–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:
- **CDN cache**: 30 –¥–Ω–µ–π
- **Browser cache**: 30 –¥–Ω–µ–π

#### –î–ª—è —à—Ä–∏—Ñ—Ç–æ–≤:
- **CDN cache**: 1 –≥–æ–¥ (365 –¥–Ω–µ–π)
- **Browser cache**: 1 –≥–æ–¥ (365 –¥–Ω–µ–π)

### –°–æ–∑–¥–∞–Ω–∏–µ CDN —Ä–µ—Å—É—Ä—Å–∞ —á–µ—Ä–µ–∑ CLI

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ CDN —Ä–µ—Å—É—Ä—Å–∞
yc cdn resource create \
  --cname —Ä–∏—Ç—É–∞–ª-–≤–µ–∫.—Ä—Ñ \
  --origin-group-id YOUR_ORIGIN_GROUP_ID \
  --origin-protocol https \
  --secondary-hostnames www.—Ä–∏—Ç—É–∞–ª-–≤–µ–∫.—Ä—Ñ
```

## üìä –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

### –¢–∞–±–ª–∏—Ü–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

| –¢–∏–ø —Ä–µ—Å—É—Ä—Å–∞ | CDN Cache | Browser Cache | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-------------|-----------|---------------|-------------|
| HTML —Ñ–∞–π–ª—ã | 5 –º–∏–Ω—É—Ç | 5 –º–∏–Ω—É—Ç | –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ |
| JS/CSS —Å —Ö—ç—à–µ–º | 1 –≥–æ–¥ | 1 –≥–æ–¥ | –ù–µ–∏–∑–º–µ–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã |
| –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è | 30 –¥–Ω–µ–π | 30 –¥–Ω–µ–π | –°—Ä–µ–¥–Ω–∏–π —Å—Ä–æ–∫ –¥–ª—è –∫–∞—Ä—Ç–∏–Ω–æ–∫ |
| –®—Ä–∏—Ñ—Ç—ã | 1 –≥–æ–¥ | 1 –≥–æ–¥ | –†–µ–¥–∫–æ –∏–∑–º–µ–Ω—è—é—Ç—Å—è |
| API –æ—Ç–≤–µ—Ç—ã | –û—Ç–∫–ª—é—á–µ–Ω | –û—Ç–∫–ª—é—á–µ–Ω | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç |

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ HTTP –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –≤ CDN

–í —Ä–∞–∑–¥–µ–ª–µ **HTTP headers and methods** –¥–æ–±–∞–≤—å—Ç–µ:

```nginx
# –î–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
add_header Cache-Control "public, max-age=31536000, immutable" always;
add_header Vary "Accept-Encoding" always;

# –î–ª—è HTML —Ñ–∞–π–ª–æ–≤
add_header Cache-Control "public, max-age=300" always;

# –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
add_header X-Content-Type-Options "nosniff" always;
add_header X-Frame-Options "DENY" always;
add_header X-XSS-Protection "1; mode=block" always;
```

## üöÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤
curl -I https://—Ä–∏—Ç—É–∞–ª-–≤–µ–∫.—Ä—Ñ/
curl -I https://—Ä–∏—Ç—É–∞–ª-–≤–µ–∫.—Ä—Ñ/assets/index-hash.js
curl -I https://—Ä–∏—Ç—É–∞–ª-–≤–µ–∫.—Ä—Ñ/assets/image.webp
curl -I https://—Ä–∏—Ç—É–∞–ª-–≤–µ–∫.—Ä—Ñ/assets/font.woff2
```

### –û–∂–∏–¥–∞–µ–º—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞

```http
# HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã
Cache-Control: public, max-age=300
X-Content-Type-Options: nosniff
X-Frame-Options: DENY

# –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—Å—É—Ä—Å—ã (JS/CSS/—à—Ä–∏—Ñ—Ç—ã)
Cache-Control: public, max-age=31536000, immutable
Vary: Accept-Encoding

# –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
Cache-Control: public, max-age=2592000
Vary: Accept-Encoding
```

## üìà –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:

- **üöÄ –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏**: 30-50% –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ—Å–µ—â–µ–Ω–∏–π
- **üìâ –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä**: 60-80% –º–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- **üìä PageSpeed Insights**: +10-20 –±–∞–ª–ª–æ–≤ –∫ –æ–±—â–µ–π –æ—Ü–µ–Ω–∫–µ
- **üí∞ –≠–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞**: –¥–æ 70% —Å–Ω–∏–∂–µ–Ω–∏–µ –∏—Å—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞
- **‚ö° –£–ª—É—á—à–µ–Ω–∏–µ UX**: –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤

## üîÑ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—ç—à–µ–º

### –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Cloud CDN** ‚Üí **CDN resources**
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à —Ä–µ—Å—É—Ä—Å `—Ä–∏—Ç—É–∞–ª-–≤–µ–∫.—Ä—Ñ`
3. –í —Ä–∞–∑–¥–µ–ª–µ **Content** –Ω–∞–∂–º–∏—Ç–µ **Purge cache**
4. –£–∫–∞–∂–∏—Ç–µ –ø—É—Ç–∏ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏:
   - `/*` - –æ—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫—ç—à
   - `/assets/*` - –æ—á–∏—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—Å—É—Ä—Å—ã
   - `/index.html` - –æ—á–∏—Å—Ç–∏—Ç—å –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É

### –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ CLI

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ CLI –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
yc init

# –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
yc cdn cache purge \
  --resource-id YOUR_CDN_RESOURCE_ID \
  --path "/*"

# –û—á–∏—Å—Ç–∫–∞ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
yc cdn cache purge \
  --resource-id YOUR_CDN_RESOURCE_ID \
  --path "/assets/*.js" \
  --path "/assets/*.css" \
  --path "/index.html"
```

## üõ†Ô∏è –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –¥–µ–ø–ª–æ—è

### GitHub Actions –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è

```yaml
# .github/workflows/deploy.yml
name: Deploy to Yandex Cloud
on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm ci

      - name: Build project
        run: npm run build

      - name: Deploy to S3
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.YC_ACCESS_KEY }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.YC_SECRET_KEY }}
        run: |
          aws s3 sync dist/ s3://ritual-vek-frontend --delete \
            --endpoint-url=https://storage.yandexcloud.net

      - name: Purge CDN cache
        env:
          YC_TOKEN: ${{ secrets.YC_TOKEN }}
        run: |
          yc cdn cache purge \
            --resource-id ${{ secrets.CDN_RESOURCE_ID }} \
            --path "/*"
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

1. **üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ staging
2. **üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –º–µ—Ç—Ä–∏–∫–∏ –ø–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è
3. **üîÑ –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è**: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫—É –∫—ç—à–∞ –ø—Ä–∏ –¥–µ–ø–ª–æ–µ
4. **üîê CORS**: –ü—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ CORS –¥–ª—è —à—Ä–∏—Ñ—Ç–æ–≤ –∏ API
5. **üì¶ Gzip**: –í–∫–ª—é—á–∏—Ç–µ —Å–∂–∞—Ç–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ CDN
6. **üõ°Ô∏è Security headers**: –î–æ–±–∞–≤—å—Ç–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

- **Yandex.Metrica**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Å–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü
- **PageSpeed Insights**: –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–µ–≥—É–ª—è—Ä–Ω–æ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- **CDN —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ hit rate –≤ Cloud CDN
- **Core Web Vitals**: –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ LCP, FID, CLS –º–µ—Ç—Ä–∏–∫–∏