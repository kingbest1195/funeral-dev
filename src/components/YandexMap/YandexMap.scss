@use "@/styles/mixins" as *;
@use "@/styles/variables" as *;

// =================
// YANDEX MAP COMPONENT
// =================

.yandex-map {
  position: relative;
  width: 100%;
  min-height: 400px; // Минимальная высота для карты
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
  overflow: hidden;
  box-shadow: var(--shadow-md);
  background-color: var(--color-bg-secondary);

  // Контейнер карты
  &__container {
    width: 100%;
    height: 100%;
    min-height: inherit; // Наследуем минимальную высоту
    border-radius: inherit;
  }

  // Состояние загрузки
  &__loader {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    width: 100%;
    height: 100%;
    min-height: inherit; // Наследуем минимальную высоту
    background-color: var(--color-bg-primary);
    color: var(--color-text-secondary);

    &-spinner {
      width: var(--spacing-10);
      height: var(--spacing-10);
      border: var(--spacing-1) solid var(--color-border);
      border-top: var(--spacing-1) solid var(--color-accent);
      border-radius: 50%;
      animation: yandex-map-spin 1s linear infinite;
      margin-bottom: var(--spacing-4);
    }

    &-text {
      font-size: var(--font-size-sm);
      color: var(--color-text-muted);
    }
  }

  // Fallback при ошибке API
  &__fallback {
    padding: var(--spacing-6);
    min-height: inherit; // Наследуем минимальную высоту
    background-color: var(--color-bg-primary);
    border: var(--spacing-px) solid var(--color-border);
    border-radius: var(--border-radius-md);
    display: flex;
    flex-direction: column;

    &-title {
      font-size: var(--font-size-lg);
      font-weight: var(--font-weight-semibold);
      color: var(--color-text-primary);
      margin-bottom: var(--spacing-4);
    }

    &-list {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-5);
    }
  }

  // Адаптивность
  @include mobile {
    // На мобильных карта квадратная
    aspect-ratio: 1 / 1;
    border-radius: var(--border-radius-sm);
  }
}

// =================
// OFFICE FALLBACK CARD
// =================

.office-fallback {
  padding: var(--spacing-4);
  background-color: var(--color-bg-secondary);
  border-radius: var(--border-radius-sm);
  border: var(--spacing-px) solid var(--color-border);

  &__title {
    font-size: var(--font-size-base);
    font-weight: var(--font-weight-semibold);
    color: var(--color-text-primary);
    margin-bottom: var(--spacing-2);
  }

  &__address {
    font-size: var(--font-size-sm);
    color: var(--color-text-primary);
    margin-bottom: var(--spacing-1);
  }

  &__note {
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
    font-style: italic;
    margin-bottom: var(--spacing-1);
  }

  &__schedule {
    font-size: var(--font-size-xs);
    color: var(--color-text-secondary);
    margin-bottom: var(--spacing-3);
  }

  &__actions {
    display: flex;
    gap: var(--spacing-3);
    flex-wrap: wrap;

    @media (max-width: 575px) {
      flex-direction: column;
      gap: var(--spacing-2);
    }
  }
}

// =================
// BALLOON POPUP STYLES (для Яндекс.Карт)
// Эти стили будут применяться к HTML внутри balloon
// =================

// Global styles for balloon (CSS не SCSS-модули)
.office-balloon {
  max-width: 280px;
  font-family: var(--font-body);

  .office-balloon__content {
    margin-bottom: var(--spacing-3);
  }

  .office-balloon__address {
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    color: var(--color-text-primary);
    margin-bottom: var(--spacing-1);
    line-height: var(--line-height-snug);
  }

  .office-balloon__note {
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
    font-style: italic;
    margin-bottom: var(--spacing-1);
  }

  .office-balloon__schedule {
    font-size: var(--font-size-xs);
    color: var(--color-text-secondary);
    margin-bottom: 0;
  }

  .office-balloon__actions {
    display: flex;
    gap: var(--spacing-2);
    justify-content: space-between;
  }

  // Кнопки внутри balloon
  .btn {
    font-size: var(--font-size-xs);
    padding: var(--spacing-1) var(--spacing-2);
    border-radius: var(--border-radius-xs);
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    border: var(--spacing-px) solid transparent;

    &.btn--primary {
      background-color: var(--color-accent);
      color: var(--color-text-white);
      border-color: var(--color-accent);

      &:hover {
        background-color: var(--color-accent-dark);
        border-color: var(--color-accent-dark);
        transform: translateY(-1px);
      }
    }

    &.btn--secondary {
      background-color: transparent;
      color: var(--color-accent);
      border-color: var(--color-accent);

      &:hover {
        background-color: var(--color-accent);
        color: var(--color-text-white);
        transform: translateY(-1px);
      }
    }

    &.btn--sm {
      min-width: 80px;
      height: 28px;
    }
  }
}

// =================
// ANIMATIONS
// =================

@keyframes yandex-map-spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

// =================
// YANDEX MAPS CONTROLS CUSTOMIZATION
// Переопределяем стили стандартных контролов Яндекс.Карт
// =================

.yandex-map {
  // Стилизация zoom control
  .ymaps-2-1-79-controls__toolbar {
    border-radius: var(--border-radius-sm) !important;
    box-shadow: var(--shadow-sm) !important;
  }

  // Стилизация type selector
  .ymaps-2-1-79-type-selector {
    border-radius: var(--border-radius-sm) !important;
    box-shadow: var(--shadow-sm) !important;
  }

  .ymaps-2-1-79-type-selector__item {
    border-radius: var(--border-radius-xs) !important;
  }

  // Стилизация balloon
  .ymaps-2-1-79-balloon {
    border-radius: var(--border-radius-md) !important;
    box-shadow: var(--shadow-lg) !important;
  }

  // Стилизация маркеров
  .ymaps-2-1-79-placemark-overlay {
    filter: drop-shadow(var(--shadow-sm));
  }

  // Скрытие стандартных контролов
  .ymaps-2-1-79-gotoymaps,
  .ymaps-2-1-79-controls__control_toolbar,
  .ymaps-2-1-79-gototech {
    display: none;
  }
}

// =================
// ACCESSIBILITY
// =================

.yandex-map {
  &:focus-within {
    outline: var(--spacing-1) solid var(--color-accent);
    outline-offset: var(--spacing-1);
  }

  // Скрытый текст для скрин-ридеров
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
}

// =================
// PRINT STYLES
// =================

@media print {
  .yandex-map {
    &__container {
      display: none;
    }

    &__fallback {
      display: block !important;
      break-inside: avoid;
    }
  }
}
